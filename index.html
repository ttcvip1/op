<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTC Checker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .output {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
        }
        .green {
            color: green;
        }
    </style>
</head>
<body>
    <h1>OTC Checker Tool</h1>
    <label for="asset">Enter asset name (e.g., BRLUSD_otc):</label>
    <input type="text" id="asset" placeholder="Enter asset name">
    
    <br><br>
    <label for="days">Enter days max 10 (e.g., 10):</label>
    <input type="text" id="days" placeholder="Enter days separated by commas">
    
    <br><br>
    <button onclick="fetchSummary()">Get Summary</button>

    <div id="output" class="output"></div>

    <script>
        // Function to fetch the summary
        async function fetchSummary() {
            const asset = document.getElementById("asset").value.trim();
            const daysInput = document.getElementById("days").value.trim();

            // Validate the input for days
            let days;
            try {
                days = daysInput.split(",").map(day => parseInt(day.trim(), 10));
                if (days.some(day => isNaN(day))) throw new Error("Invalid days input");
            } catch (error) {
                alert("Invalid day input. Please enter valid numbers (e.g., 1,3,5,10).");
                return;
            }

            // Get current UTC time and adjust for UTC+6
            const now = new Date();
            const startTime = new Date(now.getTime() + 1 * 60 * 1000); // Start time: 1 minute ahead
            const endTime = new Date(now.getTime() + 2 * 60 * 1000);   // End time: 2 minutes ahead
            const start_time = `${startTime.getUTCHours()}:${String(startTime.getUTCMinutes()).padStart(2, "0")}`;
            const end_time = `${endTime.getUTCHours()}:${String(endTime.getUTCMinutes()).padStart(2, "0")}`;

            // Show the calculated times
            document.getElementById("output").innerHTML = `
                <strong>Calculated Start Time (UTC+6):</strong> ${start_time} <br>
                <strong>Calculated End Time (UTC+6):</strong> ${end_time} <br><br>
            `;

            // Base URL
            const base_url = "https://alltradingapi.com/checker/otc_checker.ts";

            // Loop through user-specified days and make requests
            for (let day of days) {
                try {
                    const params = new URLSearchParams({
                        pair: asset,
                        start_time: start_time,
                        end_time: end_time,
                        day: day
                    });
                    const response = await fetch(`${base_url}?${params}`);
                    const data = await response.json();

                    const summary = data.summary || {};
                    if (summary) {
                        let outputHtml = `<h2>Summary for Day ${day}:</h2>`;
                        for (let timePeriod in summary) {
                            const metrics = summary[timePeriod];
                            const callAccuracy = metrics.call_accuracy || 0;
                            const putAccuracy = metrics.put_accuracy || 0;
                            const flatAccuracy = metrics.flat_accuracy || 0;

                            let finalDirection = "FLAT";
                            let maxAccuracy = Math.max(callAccuracy, putAccuracy, flatAccuracy);
                            if (maxAccuracy === callAccuracy) {
                                finalDirection = `CALL ðŸ”¼`;
                            } else if (maxAccuracy === putAccuracy) {
                                finalDirection = `PUT ðŸ”½`;
                            }

                            outputHtml += `
                                <div class="green">
                                    <strong>Time Period: ${timePeriod}</strong><br>
                                    PUT ACCURACY: ${putAccuracy}%<br>
                                    CALL ACCURACY: ${callAccuracy}%<br>
                                    FLAT ACCURACY: ${flatAccuracy}%<br>
                                    FINAL DIRECTION: ${finalDirection}<br><br>
                                </div>
                            `;
                        }
                        document.getElementById("output").innerHTML += outputHtml;
                    } else {
                        document.getElementById("output").innerHTML += `<p>No summary data available for Day ${day}.</p>`;
                    }
                } catch (error) {
                    document.getElementById("output").innerHTML += `<p>Error fetching data for Day ${day}: ${error.message}</p>`;
                }
            }
        }
    </script>
</body>
</html>
